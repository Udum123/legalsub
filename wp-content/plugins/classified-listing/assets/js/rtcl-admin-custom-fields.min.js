!function(e){"use strict";var t=function(){this.storage=[{type:"hasValue",operator:"!=empty",label:"Has any value",fieldTypes:["text","textarea","number","url","checkbox","radio","date","select"],choices:function(e){return'<input type="text" disabled="" />'}},{type:"hasNoValue",operator:"==empty",fieldTypes:["text","textarea","number","url","checkbox","radio","date","select"],label:"Has no value",choices:function(e){return'<input type="text" disabled="" />'}},{type:"contains",operator:"==contains",label:"Value contains",fieldTypes:["text","textarea","number","url","select"],choices:function(e){return'<input type="text" />'}},{type:"equalTo",operator:"==",label:"Value is equal to",fieldTypes:["text","textarea","number","url"],choices:function(e){return'<input type="text" />'}},{type:"notEqualTo",operator:"!=",fieldTypes:["text","textarea","number","url"],label:"Value is not equal to",choices:function(e){return'<input type="text" />'}},{type:"patternMatch",operator:"==pattern",label:"Value matches pattern",fieldTypes:["text","textarea","url"],choices:function(e){return'<input type="text" placeholder="[a-z0-9]" />'}},{type:"selectEqualTo",operator:"==",label:"Value is equal to",fieldTypes:["select","checkbox","radio"],choices:function(e){return e.options}},{type:"selectNotEqualTo",operator:"!=",label:"Value is not equal to"},{type:"greaterThan",operator:">",label:"Value is greater than",fieldTypes:["number"],choices:function(e){return'<input type="number" />'}},{type:"lessThan",operator:"<",label:"Value is less than",fieldTypes:["number"],choices:function(e){return'<input type="number" />'}},{type:"selectionGreaterThan",operator:">",label:"Selection is greater than",fieldTypes:["checkbox","select"],choices:function(e){return'<input type="number" />'}},{type:"selectionLessThan",operator:"<",label:"Selection is less than",fieldTypes:["checkbox","select"],choices:function(e){return'<input type="number" />'}}]},n=function(){this.data=e.extend(!0,{},this.data)};n.prototype={id:"",$el:null,data:{},busy:!1,changed:!1,events:{},actions:{},filters:{},eventScope:"",wait:!1,priority:10,extend:function(t){var n=e.extend({},this,t);return e.each(n.events,(function(e,t){n._add_event(e,t)})),setTimeout((function(){n.initialize()}),10),n},$:function(e){return this.$el.find(e)},get:function(e,t){return t=t||null,void 0!==this[e]&&(t=this[e]),t},set:function(e,t){return this[e]=t,"function"==typeof this["_set_"+e]&&this["_set_"+e].apply(this),this},_add_event:function(t,n){var i=this,r=t.substr(0,t.indexOf(" ")),o=t.substr(t.indexOf(" ")+1),l=i.field.context_id;e(document).on(r,l+" "+o,(function(e){i[n].apply(i,[e])}))}};var i={name:"conditional_logic",events:{"change .conditions-toggle":"onChangeToggle","click .add-conditional-group":"onClickAddGroup","focus .condition-rule-field":"onFocusField","change .condition-rule-field":"onChangeField","change .condition-rule-operator":"onChangeOperator","click .add-conditional-rule":"onClickAdd","click .remove-conditional-rule":"onClickRemove"},$rule:!1,scope:function(e){return this.$rule=e,this},initialize:function(){this.render()},ruleData:function(e,t){return this.$rule.data.apply(this.$rule,arguments)},$input:function(e){return this.$rule.find(".condition-rule-"+e)},$td:function(e){return this.$rule.find("td."+e)},$hiddenField:function(){return e('<input type="hidden" data-disable="'+this.name+'" name="rtcl[fields]['+this.field.id+"][_"+this.name+']" value="0" />')},$toggle:function(){return this.$(".conditions-toggle")},$control:function(){return this.$(".rule-groups")},$groups:function(){return this.$(".rule-group")},$rules:function(){return this.$(".rule")},open:function(){var t=this.$control();t.find("[name]").each((function(){e(this).prop("disabled",!1)})),t.find('input[data-disable="conditional_logic"]').remove(),t.show()},close:function(){var t=this.$control();t.find("[name]").each((function(){e(this).prop("disabled",!0)})),t.find('input[data-disable="conditional_logic"]').length||t.append(this.$hiddenField()),t.hide()},render:function(){this.$toggle().prop("checked")?(this.renderRules(),this.open()):this.close()},renderRules:function(){var t=this;this.$rules().each((function(){t.renderRule(e(this))}))},renderRule:function(e){this.scope(e),this.renderField(),this.renderOperator(),this.renderValue()},renderField:function(){var e=[],t=this.field.id,n=this.$input("field");o.getFieldObjects().map((function(n){var i={id:n.id,text:n.label};n.id===t&&(i.text+="(this field)",i.disabled=!0),e.push(i)})),e.length||e.push({id:"",text:"No toggle fields available"}),o.renderSelect(n,e),this.ruleData("field",n.val())},renderOperator:function(){if(this.ruleData("field")){var e=this.$input("operator"),t=(e.val(),[]);null===e.val()&&o.renderSelect(e,[{id:this.ruleData("operator"),text:""}]),o.getConditionTypes(this.ruleData("field")).map((function(e){t.push({id:e.operator,text:e.label})})),o.renderSelect(e,t),this.ruleData("operator",e.val())}},renderValue:function(){if(this.ruleData("field")&&this.ruleData("operator")){var t=this.$input("value"),n=this.$td("value"),i=t.val(),r=o.getFieldObjects(this.ruleData("field")),l=o.getConditionTypes(this.ruleData("field"),this.ruleData("operator")),a=l?l[0]:null,s=a?a.choices(r):null,c="";s instanceof Array?(c=e("<select></select>"),o.renderSelect(c,s)):c=e(s),t.detach(),n.html(c),setTimeout((function(){["class","name","id"].map((function(e){c.attr(e,t.attr(e))}))}),0),c.prop("disabled")||o.val(c,i,!0),this.ruleData("value",c.val())}},onChangeToggle:function(){this.render()},onClickAddGroup:function(e,t){e.preventDefault(),this.addGroup()},addGroup:function(){var e=this.$(".rule-group:last"),t=o.duplicate(e);t.find("h4").text(o.__("or")),t.find("tr").not(":first").remove(),t.insertAfter(e)},onFocusField:function(e,t){this.renderField()},onChangeField:function(t){var n=e(t.target);this.scope(n.closest(".rule")),this.ruleData("field",n.val()),this.renderOperator(),this.renderValue()},onChangeOperator:function(t){var n=e(t.target);this.scope(n.closest(".rule")),this.ruleData("operator",n.val()),this.renderValue()},onClickAdd:function(t){t.preventDefault();var n=e(t.target).closest(".rule");o.duplicate(n).insertAfter(n),this.renderRule(n)},onClickRemove:function(t){t.preventDefault();var n=e(t.target).closest(".rule");0===n.siblings(".rule").length&&n.closest(".rule-group").remove(),n.remove()}},r=function(){this.$field_group=e("#rtcl-cfg"),this.uniqidSeed=null,this.fields={},this.models={},this.tempModels={},this.conditions=[],this.init()};r.prototype={__:function(e){return e},init:function(){var r=this;this.conditions=(new t).storage,this.models[i.name]=i,this.generateFieldData(),e.each(this.fields,(function(t,i){e.each(i,(function(t,o){var l=r.models[t];if(l&&Object.keys(l).length){var a=e.extend(l,{$el:i.$el,field:i}),s=new n;r.tempModels[t]=s.extend(a)}}))}))},getFieldObjects:function(t){if(t)return this.fields[t];var n=[];return e.each(this.fields,(function(e,t){n.push(t)})),n},getConditionTypes:function(e,t){if(e){var n=this.fields[e]||null;if(n)return this.conditions.filter((function(e){return!(n.type&&(!e.fieldTypes||-1===e.fieldTypes.indexOf(n.type)))&&!(t&&(!e.operator||t!==e.operator))}))}return this.conditions},generateFieldData:function(t){var n=this;n.fields={},n.$field_group.find(".rtcl-cf-postbox").each((function(){var i=e(this),r={$el:i,context_id:"#"+i.attr("id"),id:i.data("id"),type:i.attr("id").replace("rtcl-custom-field-","").split("-")[0]};t&&r.id!==t||(i.find(".rtcl-cfg-field-group").each((function(){var t=e(this),i=t.data("field_item");if(i)if(-1!==["label","slug","description"].indexOf(i))r[i]=t.find(".widefat").val(),"label"!==i||r[i]||(r[i]=n.__("Untitled"));else if(-1!==["required","searchable","listable","conditional_logic"].indexOf(i))r[i]=!!t.find("input[type=radio]").val();else if("options"===i){var o=[];t.find("table tbody tr").each((function(){var t=e(this),n={text:t.find("td.label input").val(),id:t.find("td.value input").val()};o.push(n)})),r[i]=o}})),n.fields[r.id]=r,i.data("rtcl_cf",r))}))},val:function(e,t,n){var i=e.val();return t!==i&&(e.val(t),e.is("select")&&null===e.val()?(e.val(i),!1):(!0!==n&&e.trigger("change"),!0))},_add_event:function(t,n,i){var r=t.substr(0,t.indexOf(" ")),o=t.substr(t.indexOf(" ")+1),l=i.field.context_id;e(document).on(r,l+" "+o,(function(t){t.$el=e(this),t.$field=t.$el.closest(".rtcl-cf-postbox"),i.set("$field",t.$field),i[n].apply(i,[t])}))},renderSelect:function(e,t){var n=e.val(),i=[];return e.html(function e(t){var n="";return t.map((function(t){var r=t.text||t.label||"",l=t.id||t.value||"";i.push(l.toString()),t.children?n+='<optgroup label="'+o.escAttr(r)+'">'+e(t.children)+"</optgroup>":n+='<option value="'+o.escAttr(l)+'"'+(t.disabled?' disabled="disabled"':"")+">"+o.strEscape(r)+"</option>"})),n}(t)),i.indexOf(n)>-1&&e.val(n),e.val()},strEscape:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return(""+e).replace(/[&<>"']/g,(function(e){return t[e]}))},escAttr:function(e){return this.strEscape(e)},escHtml:function(e){return(""+e).replace(/<script|<\/script/g,(function(e){return o.strEscape(e)}))},duplicate:function(e){e instanceof jQuery&&(e={target:e});var t=function(t){return function(n,i){return e.replacer(t,i,e.search,e.replace)}};(e=Object.assign({},{target:!1,search:"",replacer:function(e,t,n,i){return t.replace(n,i)}},e)).target=e.target||e.$el;var n=e.target;e.search=e.search||n.attr("data-id"),e.replace=e.replace||this.uniqid();var i=n.clone();return i.attr("data-id",e.replace),i.find('[id*="'+e.search+'"]').attr("id",t("id")),i.find('[for*="'+e.search+'"]').attr("for",t("for")),i.find('[name*="'+e.search+'"]').attr("name",t("name")),i},uniqid:function(e,t){var n;void 0===e&&(e="");var i=function(e,t){return t<(e=parseInt(e,10).toString(16)).length?e.slice(e.length-t):t>e.length?Array(t-e.length+1).join("0")+e:e};return this.uniqidSeed||(this.uniqidSeed=Math.floor(123456789*Math.random())),this.uniqidSeed++,n=e,n+=i(parseInt((new Date).getTime()/1e3,10),8),n+=i(this.uniqidSeed,5),t&&(n+=(10*Math.random()).toFixed(8).toString()),n}};var o=new r;function l(){e(document).on("blur focus click",".js-rtcl-slugize",(function(){var t=e(this).val();if(""===t&&(t=jQuery(".js-rtcl-slugize-source",e(this).closest(".postbox")).val()),""!==t){var n=function(e){if("string"!=typeof e||""===e)return;return e=(e=(e=(e=(e=e.toLowerCase()).replace(/[^a-z0-9A-Z_]+/g,"-")).replace(/\-+/g,"-")).replace(/^\-/g,"")).replace(/\-$/g,"")}(t);n===t&&""!==e(this).val()||e(this).val(n.substring(0,200))}}))}function a(){if(e.fn.select2){var t=function(t){var n=t.element;return'<i class="rtcl-icon rtcl-icon-'+e(n).data("icon")+'"></i> '+t.text};e(".rtcl-select2").select2({dropdownAutoWidth:!0,width:"100%"}),e(".rtcl-select2-icon").select2({dropdownAutoWidth:!0,width:"100%",templateSelection:t,templateResult:t,escapeMarkup:function(e){return e}})}}function s(){e("#rtcl-cfg").sortable({cursor:"ns-resize",axis:"y",handle:"h2.hndle",forcePlaceholderSize:!0,tolerance:"pointer",start:function(e,t){t.placeholder.height(t.item.height()+23)}})}void 0===window.rtclCf&&(window.rtclCf=o),e((function(){s(),l(),a()})),e(document).on("click",".rtcl-cf-add-new",(function(t){t.preventDefault(),console.log("clicked");var n=e(this),i=e('<div style="display:none;height:450px;" class="rtcl-choose-field">'+n.data("message-loading")+"</div>").appendTo("body");function r(t){e("#post-body-content #rtcl-cfg").append(t);var n=e("#post-body-content #rtcl-cfg .postbox").last();e("html, body").animate({scrollTop:n.offset().top-50},1e3),i.dialog("close"),l(),e(".postbox .hndle, .postbox .handlediv").unbind("click.postboxes"),postboxes.add_postbox_toggles(),a(),n.typesFieldOptionsSortable(),n.typesMarkExistingField(),s()}return i.dialog({close:function(e,t){i.remove()},closeText:!1,modal:!0,minWidth:810,maxHeight:.9*e(window).height(),title:n.data("dialog-title"),position:{my:"center top+50",at:"center top",of:window}}),i.load(ajaxurl,{action:"rtcl_edit_field_choose"},(function(t,n,l){e(i).on("click","span.rtcl-field-button-insert",(function(){var t=e(this),n=t.data("type");e.ajax({url:ajaxurl,method:"POST",data:{action:"rtcl_edit_field_insert",type:n,id:parseInt(e("#post_ID").val(),10),__rtcl_wpnonce:rtcl_cfg.__rtcl_wpnonce},beforeSend:function(){t.rtclBlock()},success:function(e){t.rtclUnblock(),e.error?alert(e.msg):(r(e.data),o.init())},error:function(e,n){t.rtclUnblock(),alert("Uncaught Error.\n"+e.responseText)}})}))})),!1})).on("click",".js-rtcl-field-remove",(function(){if(confirm(e(this).data("message-confirm"))){var t=e(this).closest(".postbox"),n=parseInt(t.data("id"),10);n?e.ajax({url:ajaxurl,method:"POST",data:{action:"rtcl_edit_field_delete",id:n,__rtcl_wpnonce:rtcl_cfg.__rtcl_wpnonce},beforeSend:function(){t.rtclBlock()},success:function(n){t.rtclUnblock(),n.error?alert(n.msg):t.slideUp((function(){e(this).remove(),o.init()}))},error:function(e,n){t.rtclUnblock(),alert("Uncaught Error.\n"+e.responseText)}}):alert("Field id not selected")}return!1})).on("click",".rtcl-cfg-field .rtcl-select-options-wrap .rtcl-add-new-option",(function(t){t.preventDefault();var n=e(this),i=n.parent(".rtcl-select-options-wrap"),r=e("table.rtcl-fields-field-value-options tbody",i),o=i.data("type")||"select",l=n.data("name"),a=e("<tr />"),s=Number(new Date),c=e("tr",r).length+1,u=l+"[default]",d="radio";return"checkbox"===o&&(u=l+"[default][]",d="checkbox"),a.append("<td class='num'><span class='js-types-sort-button hndle dashicons dashicons-menu'></span></td>"),a.append("<td class='label'><input type='text' name='"+l+"[choices]["+s+"][title]' value='Option title "+c+"' ></td>"),a.append("<td class='value'><input type='text' name='"+l+"[choices]["+s+"][value]' value='option-title-"+c+"' ></td>"),a.append("<td><input type='"+d+"' name='"+u+"' value='"+s+"' ></td>"),a.append("<td class='num'><span class='rtcl-delete-option dashicons dashicons-trash'></span></td>"),r.append(a),r.typesFieldOptionsSortable(),!1})).on("click",".rtcl-cfg-field .rtcl-select-options-wrap .rtcl-delete-option",(function(t){return t.preventDefault(),confirm("Are you sure?")&&e(this).parents("tr").remove(),!1})).on("change",".is_pro .rtcl-switch-toggle",(function(e){return e.preventDefault(),alert("This is pro feature."),e.target.checked=!1,!1})),e.fn.typesFieldOptionsSortable=function(){e(".rtcl-fields-radio-sortable, .rtcl-fields-select-sortable, .rtcl-fields-checkboxes-sortable",this).sortable({cursor:"ns-resize",axis:"y",handle:".js-types-sort-button",start:function(e,t){t.placeholder.height(t.item.height()-2)}}),e(".rtcl-fields-checkboxes-sortable",this).sortable({start:function(e,t){t.placeholder.height(t.item.height()+13)}})},e.fn.typesMarkExistingField=function(){var t=e(".rtcl-forms-field-slug",this);t.length&&""!==t.val()&&t.attr("data-types-existing-field",t.val())},e("body").on("keyup",".rtcl-forms-set-legend",(function(){var t=e(this).val();t&&(t=(t=(t=(t=t.replace(/</,"&lt;")).replace(/>/,"&gt;")).replace(/'/,"&#39;")).replace(/"/,"&quot;")),e(this).parents(".postbox").find(".rtcl-legend-update").html(t)})).typesFieldOptionsSortable()}(jQuery),function(e){var t;function n(){e(".ui-dialog").each((function(){e(this).css({maxWidth:"100%",top:e(window).scrollTop()+50+"px",left:(e("body").innerWidth()-e(this).outerWidth())/2+"px"})}))}e(document).on("dialogopen",".ui-dialog",(function(t,n){e("button.button-primary, button.wpcf-ui-dialog-cancel").blur().addClass("button").removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only")})),e(window).on("resize scroll",(function(){clearTimeout(t),t=setTimeout(n,200)}))}(jQuery);
