!function(e){e.fn.getType=function(){return"INPUT"===this[0].tagName?this[0].type.toLowerCase():this[0].tagName.toLowerCase()};var t='<div class="rtcl-spinner block"><span class="rtcl-icon-spinner animate-spin"></span></div>';if(e(document.body).on("rtcl_add_error_tip",(function(t,r,a){var c=r.position();0===r.parent().find(".rtcl_error_tip").length&&(r.after('<div class="rtcl_error_tip '+a+'">'+rtcl[a]+"</div>"),r.parent().find(".rtcl_error_tip").css("left",c.left+r.width()-r.width()/2-e(".rtcl_error_tip").width()/2).css("top",c.top+r.height()).fadeIn("100"))})).on("rtcl_remove_error_tip",(function(t,r,a){r.parent().find(".rtcl_error_tip."+a).fadeOut("100",(function(){e(this).remove()}))})).on("click",(function(){e(".rtcl_error_tip").fadeOut("100",(function(){e(this).remove()}))})).on("blur","#rtcl-price[type=text], input.rtcl-price",(function(){e(".rtcl_error_tip").fadeOut("100",(function(){e(this).remove()}))})).on("keyup","#rtcl-price[type=text], input.rtcl-price",(function(){var t=new RegExp("[^-0-9%\\"+rtcl.decimal_point+"]+","gi"),r="i18n_mon_decimal_error",a=e(this).val(),c=a.replace(t,"");a!==c?e(document.body).triggerHandler("rtcl_add_error_tip",[e(this),r]):e(document.body).triggerHandler("rtcl_remove_error_tip",[e(this),r])})).on("change","#rtcl-price[type=text], input.rtcl-price",(function(){var t=new RegExp("[^-0-9%\\"+rtcl.decimal_point+"]+","gi"),r=e(this).val(),a=r.replace(t,"");r!==a&&e(this).val(a)})).on("rtcl_price_type_changed",(function(t,r){"on_call"===r.value||"free"===r.value||"no_price"===r.value?e("#rtcl-price").attr("required","false").val(""):e("#rtcl-price").attr("required","true"),e("#rtcl-price-items").removeClass((function(e,t){return(t.match(/(^|\s)rtcl-price-type\S+/g)||[]).join(" ")})).addClass("rtcl-price-type-"+r.value)})).on("rtcl_listing_pricing_type_changed",(function(t,r){e("#rtcl-pricing-items").removeClass().addClass("rtcl-pricing-"+r.value)})).on("change","#rtcl-price-type",(function(){e(document.body).trigger("rtcl_price_type_changed",[this])})).on("change","input[name=_rtcl_listing_pricing]",(function(){e(document.body).trigger("rtcl_listing_pricing_type_changed",[this])})),e.fn.validate){var r=e("form#rtcl-post-form");r.length&&r.validate({rules:{_rtcl_max_price:{greaterThan:"#rtcl-price"}},messages:{_rtcl_max_price:{greaterThan:rtcl_validator.messages.maxPrice}},submitHandler:function(t){var a=e(t),c=a.data("reCaptchaId");try{tinymce.triggerSave(),tinymce.get("description").save()}catch(e){}if(rtcl.recaptcha&&rtcl.recaptcha.on&&-1!==e.inArray("listing",rtcl.recaptcha.on)){if(2===rtcl.recaptcha.v&&void 0!==c){var n=grecaptcha.getResponse(c),s=a.find("#rtcl-listing-g-recaptcha-message");return 0===n.length?(s.addClass("text-danger").html(rtcl.recaptcha.msg.invalid),grecaptcha.reset(c),!1):(l(),!1)}if(3===rtcl.recaptcha.v)return grecaptcha.ready((function(){a.rtclBlock(),grecaptcha.execute(rtcl.recaptcha.site_key,{action:"listing"}).then((function(e){l(e)}))})),!1}return l(),!1;function l(c){var n=new FormData(t),s=e("<div class='alert rtcl-response'></div>");return c&&n.set("g-recaptcha-response",c),n.set("action","rtcl_post_new_listing"),e.ajax({url:rtcl.ajaxurl,type:"POST",dataType:"json",cache:!1,contentType:!1,processData:!1,data:n,beforeSend:function(){a.find(".alert.rtcl-response").remove(),a.find("button[type=submit]").prop("disabled",!0),a.rtclBlock()},success:function(e){a.find("button[type=submit]").prop("disabled",!1),a.rtclUnblock();var t="";e.message.length&&e.message.map((function(e){t+="<p>"+e+"</p>"})),e.success?(r[0].reset(),t&&s.removeClass("alert-danger").addClass("alert-success").html(t).appendTo(r),e.redirect_url&&setTimeout((function(){window.location.href=e.redirect_url}),500)):t&&s.removeClass("alert-success").addClass("alert-danger").html(t).appendTo(r)},error:function(e){s.removeClass("alert-success").addClass("alert-danger").html(e.responseText).appendTo(r),a.find("button[type=submit]").prop("disabled",!1),a.rtclUnblock()}}),!1}}})}e((function(){e("#rtcl-ad-type").on("change",(function(){var r=e(this),a=r.val(),c=e("<div class='alert rtcl-response'></div>"),n=r.parents("#rtcl-ad-type-selection"),s=e("#rtcl-ad-category-selection"),l=e("#rtcl-sub-category-wrap"),i=e("#sub-cat-row"),o={action:"rtcl_get_one_level_category_select_list_by_type",type:a};a?e.ajax({url:rtcl.ajaxurl,data:o,type:"POST",dataType:"json",beforeSend:function(){e(t).insertAfter(r),n.find(".alert.rtcl-response").remove(),s.find(".alert.rtcl-response").remove(),i.addClass("rtcl-hide"),l.html("")},success:function(t){r.next(".rtcl-spinner").remove(),i.addClass("rtcl-hide"),l.html("");var a="";t.message.length&&t.message.map((function(e){a+="<p>"+e+"</p>"})),t.success?(e("#rtcl-category").html(t.cats),s.slideDown()):(e("#rtcl-category").html(""),s.slideUp(),a&&c.removeClass("alert-success").addClass("alert-danger").html(a).appendTo(n))},error:function(e){r.next(".rtcl-spinner").remove(),c.removeClass("alert-success").addClass("alert-danger").html(e.responseText).appendTo(n)}}):(s.slideUp(),i.addClass("rtcl-hide"),l.html(""))})),e("#rtcl-category").on("change",(function(){var r=e(this),a=r.parents(".rtcl-post-category"),c=e("#rtcl-sub-category-wrap"),n=e("#sub-cat-row"),s=e(this).val(),l=e("#rtcl-ad-type"),i=l.val()||"",o=e("<div class='alert rtcl-response'></div>"),d={action:"rtcl_get_one_level_category_select_list",term_id:s};!i&&rtcl_add_post.hide_ad_type||i&&!rtcl_add_post.hide_ad_type?s?e.ajax({url:rtcl.ajaxurl,data:d,type:"POST",dataType:"json",beforeSend:function(){e(t).insertAfter(r),a.find(".alert.rtcl-response").remove()},success:function(t){if(r.next(".rtcl-spinner").remove(),t.success)if(t.child_cats)c.html(e('<select class="form-control" required />').append(t.child_cats)),n.removeClass("rtcl-hide");else{c.html(""),n.addClass("rtcl-hide");var l=rtcl_add_post.form_uri.toString(),d={category:s},p=-1!==l.indexOf("?")?"&":"?";!rtcl_add_post.hide_ad_type&&i&&(d.type=i),l=l+p+e.param(d),window.location=l}else if(n.addClass("rtcl-hide"),t.message.length){var u="";t.message.map((function(e){u+="<p>"+e+"</p>"})),u&&o.removeClass("alert-success").addClass("alert-danger").html(u).appendTo(a)}},error:function(e){r.next(".rtcl-spinner").remove(),o.removeClass("alert-success").addClass("alert-danger").html(e.responseText).appendTo(a)}}):(c.html(""),n.addClass("rtcl-hide")):(alert(rtcl_add_post.message.ad_type),l.focus())})),e(document).on("change","#rtcl-sub-category-wrap select",(function(){var r=e(this),a=r.parents("#rtcl-sub-category-wrap"),c=e(this).val(),n=e("#rtcl-ad-type"),s=n.val()||"",l=e("<div class='alert rtcl-response'></div>"),i={action:"rtcl_get_one_level_category_select_list",term_id:c};!s&&rtcl_add_post.hide_ad_type||s&&!rtcl_add_post.hide_ad_type?c?e.ajax({url:rtcl.ajaxurl,data:i,type:"POST",dataType:"json",beforeSend:function(){e(t).insertAfter(r),a.find(".alert.rtcl-response").remove(),r.nextAll("select").remove()},success:function(t){if(a.find(".rtcl-spinner").remove(),t.success)if(t.child_cats)a.append(e('<select class="form-control" required />').append(t.child_cats));else{var n=rtcl_add_post.form_uri.toString(),i={category:c},o=-1!==n.indexOf("?")?"&":"?";!rtcl_add_post.hide_ad_type&&s&&(i.type=s),n=n+o+e.param(i),window.location=n}else if(r.nextAll("select").remove(),t.message.length){var d="";t.message.map((function(e){d+="<p>"+e+"</p>"})),d&&l.removeClass("alert-success").addClass("alert-danger").html(d).appendTo(a)}},error:function(e){a.find(".rtcl-spinner").remove(),l.removeClass("alert-success").addClass("alert-danger").html(e.responseText).appendTo(a)}}):r.nextAll("select").remove():(alert(rtcl_add_post.message.ad_type),n.focus())})),e("#rtcl-location").on("change",(function(){var r=e(this),a=e("#rtcl-sub-location"),c=a.parents("#sub-location-row"),n={action:"rtcl_get_sub_location_options",term_id:e(this).val()};e.ajax({url:rtcl.ajaxurl,data:n,type:"POST",dataType:"json",beforeSend:function(){e(t).insertAfter(r)},success:function(t){r.next(".rtcl-spinner").remove(),a.find("option").each((function(){e(this).val().trim()&&e(this).remove()})),a.append(t.locations),t.locations?c.removeClass("rtcl-hide"):c.addClass("rtcl-hide")},error:function(){r.next(".rtcl-spinner").remove()}})})),e("#rtcl-sub-location").on("change",(function(){var r=e(this),a=e("#rtcl-sub-sub-location"),c=a.parents("#sub-sub-location-row"),n={action:"rtcl_get_sub_location_options",term_id:e(this).val()};e.ajax({url:rtcl.ajaxurl,data:n,type:"POST",dataType:"json",beforeSend:function(){e(t).insertAfter(r)},success:function(t){r.next(".rtcl-spinner").remove(),a.find("option").each((function(){e(this).val().trim()&&e(this).remove()})),a.append(t.locations),t.locations?c.removeClass("rtcl-hide"):c.addClass("rtcl-hide")},error:function(){r.next(".rtcl-spinner").remove()}})}))})),e(window).bind("beforeunload",(function(){var t=parseInt(e("#_post_id").val(),10);if(t&&0!==t&&!isNaN(t)){var r={action:"rtcl_delete_temp_listing",__rtcl_wpnonce:rtcl.__rtcl_wpnonce,id:t};e.ajax(rtcl.ajaxurl,{data:r,dataType:"json",type:"post",success:function(e){}})}}))}(jQuery);
