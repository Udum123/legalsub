var RTCL=RTCL||{};RTCL.File={alertError:0,Registered:[],RemoveItem:function(e){jQuery.each(RTCL.File.Registered,(function(t,i){void 0!==i.Item[e]&&(delete i.Item[e],i.SortableUpdate(),i.CheckFileLimit())}))},GetMime:function(e){var t="other";if(null===e)return t;if(void 0===e.mime_type)return t;var i={image:["image/jpeg","image/jpe","image/jpg","image/png"]};for(var r in i)-1!==i[r].indexOf(e.mime_type)&&(t=r);return t},GetIcon:function(e){return null===e?null:"image"===this.GetMime(e)?"rtcl-icon-file-image":["application/x-pdf","application/pdf"].indexOf(e.mime_type)?"rtcl-icon-file-pdf":["application/zip","application/octet-stream"].indexOf(e.mime_type)?"rtcl-icon-file-archive":"rtcl-icon-doc-inv"},BrowserError:function(e){new RTCL.File.Error(e,!1)}},RTCL.File.Error=function(e,t){var i=wp.template("wprtcl-browser-error"),r=jQuery,s="";if(void 0!==e.responseText?s=e.responseText:void 0!==e.error&&(s=e.error),0!==s.length){var o=i({error:s,overlay:t});this.html=r(o),this.html.find("a.rtcl-button").on("click",jQuery.proxy(this.CloseClicked,this)),jQuery("body").append(this.html)}},RTCL.File.Error.prototype.CloseClicked=function(e){void 0!==e&&e.preventDefault(),this.html.remove()},RTCL.File.Uploader=function(e){var t=jQuery;if(this.PostID=0,t(e.conf.post_id_input).val()){var i=parseInt(t(e.conf.post_id_input).val(),10);this.PostID=i||!isNaN(i)?i:0}this.Item={},this.Browser=new RTCL.File.Browser(this),this.setup=e,this.ui=t("#"+e.init.container),this.sortable=this.ui.find(".rtcl-gallery-uploads"),this.engine=new RTCL.File.Uploader.Plupload;var r=this;jQuery.each(e.data,(function(e,t){var i={id:"rtcl-file-"+t.attach_id};r.FileAdded(null,i),r.FileUploaded(i,t)})),this.sortable.sortable({update:jQuery.proxy(this.SortableUpdate,this)}),this.Plupload(e.init)},RTCL.File.Uploader.prototype.GetKeys=function(){var e=[];return e.fill(0,0,this.Item.length),jQuery.each(this.Item,(function(t,i){i.result&&(e[i.container.index()]=i.result.attach_id)})),e},RTCL.File.Uploader.prototype.GetFileCount=function(){return Object.keys(this.Item).length},RTCL.File.Uploader.prototype.CheckFileLimit=function(){(parseInt(this.setup.init.max_files,10)||5)<=this.GetFileCount()?jQuery(".rtcl-gallery").hide():jQuery(".rtcl-gallery").show()},RTCL.File.Uploader.prototype.SortableUpdate=function(e){void 0!==e&&this.ui.find(".rtcl-gallery-upload-update.rtcl-spinner").fadeIn(),jQuery.ajax({url:rtcl_gallery_lang.ajaxurl,context:this,type:"post",dataType:"json",data:{action:"rtcl_gallery_update_order",_ajax_nonce:this.setup.init.multipart_params._ajax_nonce,post_id:this.PostID,ordered_keys:this.GetKeys()},success:jQuery.proxy(this.SortableUpdateSuccess,this),error:jQuery.proxy(this.SortableUpdateError,this)})},RTCL.File.Uploader.prototype.SortableUpdateSuccess=function(e){e.success?this.ui.find(".rtcl-gallery-upload-update.rtcl-spinner").fadeOut():RTCL.File.BrowserError(e)},RTCL.File.Uploader.prototype.SortableUpdateError=function(e){this.ui.find(".rtcl-gallery-upload-update.rtcl-spinner").fadeOut(),RTCL.File.BrowserError(e)},RTCL.File.Uploader.prototype.FileAdded=function(e,t){var i=jQuery("<div></div>").addClass("rtcl-gallery-upload-item").attr("id",t.id),r={_ajax_nonce:this.setup.init.multipart_params._ajax_nonce};this.Item[t.id]=new RTCL.File.Singular(t,i,r),this.Item[t.id].SetBrowser(this.Browser),this.Item[t.id].render(),this.ui.find(".rtcl-gallery-uploads").append(i),this.CheckFileLimit()},RTCL.File.Uploader.prototype.FileUploaded=function(e,t){this.Item[e.id].setResult(t),this.Item[e.id].render(),0===this.PostID&&(this.PostID=t.post_id);var i=parseInt(jQuery(this.setup.conf.post_id_input).val(),10);i&&0!==i&&!isNaN(i)||jQuery(this.setup.conf.post_id_input).val(this.PostID),this.CheckFileLimit()},RTCL.File.Uploader.prototype.Plupload=function(e){this.uploader=new plupload.Uploader(e),this.uploader.bind("Init",jQuery.proxy(this.engine.Init,this)),this.uploader.init(),this.uploader.bind("BeforeUpload",jQuery.proxy(this.engine.BeforeUpload,this)),this.uploader.bind("FilesAdded",jQuery.proxy(this.engine.FilesAdded,this)),this.uploader.bind("FileUploaded",jQuery.proxy(this.engine.FileUploaded,this)),this.uploader.bind("Error",jQuery.proxy(this.engine.Error,this))},RTCL.File.Uploader.Plupload=function(e){},RTCL.File.Uploader.Plupload.prototype.getUploader=function(){return this.uploader},RTCL.File.Uploader.Plupload.prototype.Init=function(e){e.features.dragdrop?(this.ui.addClass("drag-drop"),this.ui.find(".rtcl-gallery").bind("dragover.wp-uploader",jQuery.proxy(this.engine.InitDragOver,this)),this.ui.find(".rtcl-drag-drop-area").bind("dragleave.wp-uploader, drop.wp-uploader",jQuery.proxy(this.engine.InitDragLeave,this))):(this.ui.removeClass("drag-drop"),this.ui.find(".rtcl-drag-drop-area").unbind(".wp-uploader"))},RTCL.File.Uploader.Plupload.prototype.InitDragOver=function(){this.ui.addClass("drag-over")},RTCL.File.Uploader.Plupload.prototype.InitDragLeave=function(){this.ui.removeClass("drag-over")},RTCL.File.Uploader.Plupload.prototype.BeforeUpload=function(e,t){e.settings.multipart_params.post_id=this.PostID},RTCL.File.Uploader.Plupload.prototype.FilesAdded=function(e,t){var i=(parseInt(this.setup.init.max_files,10)||5)-this.GetFileCount(),r=t;if(i){if(t.length>i){r=t.slice(0,i);var s=t.slice(i);console.log(t),console.log(r),console.log(s),s.length&&jQuery.each(s,(function(t,i){e.removeFile(i)}))}jQuery.each(r,jQuery.proxy(this.engine.FileAdded,this),e),e.refresh(),e.start()}else console.log(rtcl_gallery_lang.error_image_limit),alert(rtcl_gallery_lang.error_image_limit);RTCL.File.alertError=0},RTCL.File.Uploader.Plupload.prototype.FileAdded=function(e,t){var i=this.uploader;this.FileAdded(i.settings.container,t)},RTCL.File.Uploader.Plupload.prototype.FileUploaded=function(e,t,i){var r=jQuery.parseJSON(i.response);0===this.PostID&&(this.PostID=r.post_id),this.FileUploaded(t,r),this.SortableUpdate()},RTCL.File.Uploader.Plupload.prototype.Error=function(e,t){var i=rtcl_gallery_lang.error_common;if(t)switch(t.code){case-600:i=rtcl_gallery_lang.error_image_size;break;case-601:i=rtcl_gallery_lang.error_image_extension}RTCL.File.alertError||alert(i)},RTCL.File.Singular=function(e,t,i){this.file=e,this.container=t,this.init=i,this.browser=null,this.result=null,this.spinner=null,this.button={edit:null,remove:null}},RTCL.File.Singular.prototype.SetBrowser=function(e){this.browser=e},RTCL.File.Singular.prototype.render=function(){var e=wp.template("wprtcl-uploaded-file"),t=jQuery(e({file:this.file,result:this.result,mime:RTCL.File.GetMime(this.result),icon:RTCL.File.GetIcon(this.result)}));this.container.html(t),this.result&&(void 0!==this.result.error?this.container.on("click",jQuery.proxy(this.Dispose,this)):(this.button.edit=this.container.find(".rtcl-button-edit"),this.button.remove=this.container.find(".rtcl-button-remove"),this.spinner=this.container.find(".rtcl-spinner"),this.spinner.hide(),this.button.edit.on("click",jQuery.proxy(this.EditClicked,this)),this.button.remove.on("click",jQuery.proxy(this.RemoveClicked,this))))},RTCL.File.Singular.prototype.Dispose=function(e){void 0!==e&&e.preventDefault();var t=this.file.id;this.container.fadeOut("fast",(function(){jQuery(this).remove(),RTCL.File.RemoveItem(t)}))},RTCL.File.Singular.prototype.EditClicked=function(e){void 0!==e&&e.preventDefault(),this.browser.Open(),this.browser.Render(this.result),this.browser.UpdateNavigation()},RTCL.File.Singular.prototype.RemoveClicked=function(e){void 0!==e&&e.preventDefault(),this.spinner.css("display","block"),jQuery.ajax({url:rtcl_gallery_lang.ajaxurl,context:this,type:"post",dataType:"json",data:{action:"rtcl_gallery_delete",_ajax_nonce:this.init._ajax_nonce,post_id:this.result.post_id,attach_id:this.result.attach_id},success:jQuery.proxy(this.RemoveClickedSuccess,this),error:jQuery.proxy(this.RemoveClickedError,this)})},RTCL.File.Singular.prototype.RemoveClickedSuccess=function(e){1==e.result?this.Dispose():(this.spinner.hide(),new RTCL.File.Error(e,!0))},RTCL.File.Singular.prototype.RemoveClickedError=function(e){this.spinner.hide(),new RTCL.File.Error(e,!0)},RTCL.File.Singular.prototype.setResult=function(e){this.result=e},RTCL.File.Singular.prototype.Uploaded=function(){},RTCL.File.Browser=function(e){this.file=null,this.uploader=e;var t=wp.template("wprtcl-browser")({modal_id:"xxx"}),i=jQuery(t);i.find(".wprtcl-overlay-close").on("click",jQuery.proxy(this.Close,this)),i.find(".wprtcl-file-pagi-prev").on("click",jQuery.proxy(this.PrevClicked,this)),i.find(".wprtcl-file-pagi-next").on("click",jQuery.proxy(this.NextClicked,this)),this.browser=i,this.browser.hide(),jQuery("body").append(this.browser)},RTCL.File.Browser.prototype.SetFile=function(e){this.file=e},RTCL.File.Browser.prototype.GetNavigation=function(){var e=this.uploader.GetKeys(),t=e.indexOf(this.file.attach_id),i=!1,r=!1;return t>0&&(i=e[t-1]),t+1<e.length&&(r=e[t+1]),{prev_id:i,next_id:r}},RTCL.File.Browser.prototype.UpdateNavigation=function(){var e=this.GetNavigation();e.prev_id?this.browser.find(".wprtcl-file-pagi-prev").removeClass("wprtcl-navi-disabled"):this.browser.find(".wprtcl-file-pagi-prev").addClass("wprtcl-navi-disabled"),e.next_id?this.browser.find(".wprtcl-file-pagi-next").removeClass("wprtcl-navi-disabled"):this.browser.find(".wprtcl-file-pagi-next").addClass("wprtcl-navi-disabled")},RTCL.File.Browser.prototype.Open=function(e){void 0!==e&&e.preventDefault(),this.browser.show()},RTCL.File.Browser.prototype.Close=function(e){void 0!==e&&e.preventDefault(),this.browser.hide()},RTCL.File.Browser.prototype.NextClicked=function(e){void 0!==e&&e.preventDefault();var t=this.GetNavigation(),i=null;!1!==t.next_id&&(jQuery.each(this.uploader.Item,(function(e,r){r.result.attach_id==t.next_id&&(i=e)})),this.Render(this.uploader.Item[i].result),this.UpdateNavigation())},RTCL.File.Browser.prototype.PrevClicked=function(e){void 0!==e&&e.preventDefault();var t=this.GetNavigation(),i=null;!1!==t.prev_id&&(jQuery.each(this.uploader.Item,(function(e,r){r.result.attach_id==t.prev_id&&(i=e)})),this.Render(this.uploader.Item[i].result),this.UpdateNavigation())},RTCL.File.Browser.prototype.Render=function(e){if(this.SetFile(e),Date.now)t=Date.now();else var t=(new Date).getTime();var i=wp.template("wprtcl-browser-attachment-view"),r=RTCL.File.GetMime(e),s=jQuery(i({mime:r,icon:RTCL.File.GetIcon(this.file),file:this.file,timestamp:t}));s.find(".wprtcl-image-sizes").on("change",jQuery.proxy(this.ImageSizeChanged,this)),s.find(".rtcl-upload-modal-update").on("click",jQuery.proxy(this.UpdateDescription,this)),this.element={spinner:s.find(".rtcl-spinner"),success:s.find(".rtcl-update-description-success"),input:{featured:s.find("input[name='rtcl_featured']"),caption:s.find("input[name='rtcl_caption']"),content:s.find("textarea[name='rtcl_content']")}},s.find(".wprtcl-attachment-edit-image").length>0&&(this.element.input.edit=s.find(".wprtcl-attachment-edit-image"),this.element.input.edit.on("click",jQuery.proxy(this.EditImage,this))),s.find(".wprtcl-attachment-create-image").length>0&&(this.element.input.edit=s.find(".wprtcl-attachment-create-image"),this.element.input.edit.on("click",jQuery.proxy(this.CreateImage,this))),this.browser.find(".wprtcl-attachment-details").html(s),this.browser.find(".wprtcl-attachment-details").find(".wprtcl-image-sizes").change(),this.imageSize&&(this.browser.find(".wprtcl-image-sizes option[value='"+this.imageSize+"']").prop("selected",!0),this.browser.find(".wprtcl-image-sizes").change()),this.imageSize=null},RTCL.File.Browser.prototype.EditImage=function(e){void 0!==e&&e.preventDefault(),this.imageSize=this.browser.find(".wprtcl-image-sizes option:selected").val(),this.actionType="edit",this.dim=[this.file.sizes[this.imageSize].width,this.file.sizes[this.imageSize].height],this.dimHistory=[],this.dimHistory.push(this.dim),this.history=[],this.ImageLoad()},RTCL.File.Browser.prototype.CreateImage=function(e){void 0!==e&&e.preventDefault(),this.imageSize=this.browser.find(".wprtcl-image-sizes option:selected").val(),this.actionType="create",this.dim=[this.file.sizes.full.width,this.file.sizes.full.height],this.dimHistory=[],this.dimHistory.push(this.dim),this.history=[],this.ImageLoad()},RTCL.File.Browser.prototype.ImageLoad=function(){this.jcrop=null,this.crop=null,this.input={};var e=this.imageSize;"create"===this.actionType&&(e=null);var t=null;"full"!==this.imageSize&&(t=RTCL_IMAGE_SIZES[this.imageSize]);var i=wp.template("wprtcl-browser-attachment-image"),r=jQuery(i({file:this.file,size:e,dim:this.dim,recommended:t,rand:Math.floor(1e4*Math.random()),history:JSON.stringify(this.history),nonce:this.uploader.setup.init.multipart_params._ajax_nonce}));r.find(".rtcl-image-action-crop").on("click",jQuery.proxy(this.ImageCrop,this)),r.find(".rtcl-image-action-rotate-ccw").on("click",jQuery.proxy(this.RotateCCW,this)),r.find(".rtcl-image-action-rotate-cw").on("click",jQuery.proxy(this.RotateCW,this)),r.find(".rtcl-image-action-flip-h").on("click",jQuery.proxy(this.ImageFlipH,this)),r.find(".rtcl-image-action-flip-v").on("click",jQuery.proxy(this.ImageFlipV,this)),r.find(".rtcl-image-action-undo").on("click",jQuery.proxy(this.ImageUndo,this)),r.find(".rtcl-image-action-save").on("click",jQuery.proxy(this.ImageSave,this)),r.find(".rtcl-image-action-cancel").on("click",jQuery.proxy(this.ImageCancel,this)),r.find(".rtcl-image-action-restore").on("click",jQuery.proxy(this.ImageRestore,this)),r.find(".rtcl-image-scale-width").on("keyup",jQuery.proxy(this.KeyWidth,this)),r.find(".rtcl-image-scale-height").on("keyup",jQuery.proxy(this.KeyHeight,this)),r.find(".rtcl-image-action-scale").on("click",jQuery.proxy(this.ImageScale,this)),this.spinner=r.find(".wprtcl-image-edit-spinner"),this.input.width=r.find(".rtcl-image-scale-width"),this.input.height=r.find(".rtcl-image-scale-height"),0==this.history.length&&(r.find(".rtcl-image-action-undo").css("opacity","0.5"),r.find(".rtcl-image-action-save").css("opacity","0.5")),r.find(".rtcl-image-action-crop").css("opacity","0.5"),this.browser.find(".wprtcl-attachment-details").html(r);var s=this.browser.find("#wprtcl-image-crop");s.load(jQuery.proxy(this.ImageCropLoaded,this)),s.attr("src",s.data("src"))},RTCL.File.Browser.prototype.ImageCropLoaded=function(e){var t={onSelect:jQuery.proxy(this.CropSelected,this),onChange:jQuery.proxy(this.CropSelected,this),onRelease:jQuery.proxy(this.CropReleased,this)};"full"==this.imageSize&&(t.trueSize=[this.dim[0],this.dim[1]]),"create"==this.actionType&&"full"!=this.imageSize&&(t.trueSize=[this.dim[0],this.dim[1]]),this.image=this.browser.find("#wprtcl-image-crop"),this.jcrop=this.image.Jcrop(t);var i=this.dimHistory[0],r=this.image.parent().width()/this.dim[0];r>1&&(r=1),this.browser.find(".rtcl-image-prop-original-size").text(i[0].toString()+" x "+i[1].toString()),this.browser.find(".rtcl-image-prop-current-size").text(this.dim[0].toString()+" x "+this.dim[1].toString()),this.browser.find(".rtcl-image-prop-zoom").text(Math.round(100*r,2).toString()+"%"),this.spinner.hide()},RTCL.File.Browser.prototype.ImageSizeChanged=function(e){var t=this.browser.find(".wprtcl-image-sizes option:selected");"video"===t.val()?(this.browser.find(".wprtcl-file-browser-image-actions").hide(),this.browser.find(".wprtcl-file-browser-video-actions").show(),this.browser.find(".wprtcl-attachment-image").hide(),this.browser.find(".wprtcl-attachment-video").show()):(this.browser.find(".wprtcl-file-browser-image-actions").show(),this.browser.find(".wprtcl-file-browser-video-actions").hide(),this.browser.find(".wprtcl-attachment-image").show(),this.browser.find(".wprtcl-attachment-video").hide()),"full"===t.val()?this.browser.find(".wprtcl-attachment-create-image").hide():this.browser.find(".wprtcl-attachment-create-image").show(),this.browser.find(".rtcl-image-preview").hide(),this.browser.find(".rtcl-image-preview.rtcl-image-preview-"+t.val()).fadeIn("fast"),this.browser.find(".rtcl-icon-size-explain-desc").text(t.data("explain"))},RTCL.File.Browser.prototype.CropSelected=function(e){this.browser.find(".wprtcl-attachment-details").find(".rtcl-image-action-crop").css("opacity","1"),this.browser.find(".rtcl-image-prop-selection").text(Math.round(e.w)+" x "+Math.round(e.h)),this.crop=e},RTCL.File.Browser.prototype.CropReleased=function(e){this.browser.find(".wprtcl-attachment-details").find(".rtcl-image-action-crop").css("opacity","0.5"),this.crop=null},RTCL.File.Browser.prototype.ImageCrop=function(e){if(void 0!==e&&e.preventDefault(),null!==this.crop){var t=this.crop;t.a="c",t.w=Math.round(t.w),t.h=Math.round(t.h),this.dimHistory.push(this.dim),this.dim=[t.w,t.h],this.history.push(t),this.crop=null,this.spinner.show(),this.ImageLoad()}},RTCL.File.Browser.prototype.RotateCW=function(e){void 0!==e&&e.preventDefault(),this.dimHistory.push(this.dim),this.dim=[this.dim[1],this.dim[0]],this.history.push({a:"ro",v:"90"}),this.spinner.show(),this.ImageLoad()},RTCL.File.Browser.prototype.RotateCCW=function(e){void 0!==e&&e.preventDefault(),this.dimHistory.push(this.dim),this.dim=[this.dim[1],this.dim[0]],this.history.push({a:"ro",v:"-90"}),this.spinner.show(),this.ImageLoad()},RTCL.File.Browser.prototype.ImageFlipH=function(e){void 0!==e&&e.preventDefault(),this.dimHistory.push(this.dim),this.dim=[this.dim[0],this.dim[1]],this.history.push({a:"f",h:!0,v:!1}),this.spinner.show(),this.ImageLoad()},RTCL.File.Browser.prototype.ImageFlipV=function(e){void 0!==e&&e.preventDefault(),this.dimHistory.push(this.dim),this.dim=[this.dim[0],this.dim[1]],this.history.push({a:"f",h:!1,v:!0}),this.spinner.show(),this.ImageLoad()},RTCL.File.Browser.prototype.KeyWidth=function(e){var t=parseInt(this.input.width.val()),i=parseInt(this.input.width.attr("max")),r=t*(parseInt(this.input.height.attr("max"))/i);this.input.height.val(Math.round(r).toString())},RTCL.File.Browser.prototype.KeyHeight=function(e){var t=parseInt(this.input.height.val())*(parseInt(this.input.width.attr("max"))/parseInt(this.input.height.attr("max")));this.input.width.val(Math.round(t).toString())},RTCL.File.Browser.prototype.ImageScale=function(e){void 0!==e&&e.preventDefault(),this.dimHistory.push(this.dim),this.dim=[this.input.width.val(),this.input.height.val()],this.history.push({a:"re",w:this.input.width.val(),h:this.input.height.val()}),this.spinner.show(),this.ImageLoad()},RTCL.File.Browser.prototype.ImageUndo=function(e){void 0!==e&&e.preventDefault(),0!==this.history.length&&(this.dim=this.dimHistory.pop(),this.history.pop(),this.spinner.show(),this.ImageLoad())},RTCL.File.Browser.prototype.ImageSave=function(e){if(void 0!==e&&e.preventDefault(),0!==this.history.length){this.spinner.show();var t=0;"full"==this.imageSize&&this.browser.find(".wprtcl-image-action-apply-to").is(":checked")&&(t=1);var i={action:"rtcl_gallery_image_save",_ajax_nonce:this.uploader.setup.init.multipart_params._ajax_nonce,post_id:this.uploader.PostID,history:JSON.stringify(this.history),size:this.imageSize,attach_id:this.file.attach_id,action_type:this.actionType,apply_to:this.imageSize,apply_to_all:t};jQuery.ajax({url:rtcl_gallery_lang.ajaxurl,context:this,type:"post",dataType:"json",data:i,success:jQuery.proxy(this.ImageSaveSuccess,this),error:jQuery.proxy(this.ImageSaveError,this)})}},RTCL.File.Browser.prototype.ImageCancel=function(e){void 0!==e&&e.preventDefault(),this.Render(this.file)},RTCL.File.Browser.prototype.ImageRestore=function(e){void 0!==e&&e.preventDefault();var t={action:"rtcl_gallery_image_restore",_ajax_nonce:this.uploader.setup.init.multipart_params._ajax_nonce,post_id:this.uploader.PostID,size:this.imageSize,attach_id:this.file.attach_id,action_type:this.actionType,apply_to:this.imageSize};jQuery.ajax({url:rtcl_gallery_lang.ajaxurl,context:this,type:"post",dataType:"json",data:t,success:jQuery.proxy(this.ImageRestoreSuccess,this),error:jQuery.proxy(this.ImageRestoreError,this)}),this.history=[],this.ImageLoad()},RTCL.File.Browser.prototype.ImageRestoreSuccess=function(e){if(this.spinner.hide(),"1"==e.result)for(var t in this.uploader.Item)this.uploader.Item[t].result.attach_id==this.file.attach_id&&(this.uploader.Item[t].result=e.file,this.file=e.file,this.Render(e.file));else new RTCL.File.Error(e,!1)},RTCL.File.Browser.prototype.ImageRestoreError=function(e){this.spinner.hide(),new RTCL.File.Error(e,!1)},RTCL.File.Browser.prototype.ImageSaveSuccess=function(e){if(console.log(e),this.spinner.hide(),"1"==e.result)for(var t in RTCL.File.Registered)for(var i in RTCL.File.Registered[t].Item)RTCL.File.Registered[t].Item[i].result.attach_id==e.file.attach_id&&(RTCL.File.Registered[t].Item[i].result=e.file,RTCL.File.Registered[t].Item[i].render(),RTCL.File.Registered[t].Browser.Render(e.file));else new RTCL.File.Error(e,!1)},RTCL.File.Browser.prototype.ImageSaveError=function(e){this.spinner.hide(),new RTCL.File.Error(e,!1)},RTCL.File.Browser.prototype.UpdateDescription=function(e){void 0!==e&&e.preventDefault(),this.element.spinner.css("display","inline-block");var t=this.element.input.featured.prop("checked")?1:0;jQuery.ajax({url:rtcl_gallery_lang.ajaxurl,context:this,type:"post",dataType:"json",data:{action:"rtcl_gallery_update",_ajax_nonce:this.uploader.setup.init.multipart_params._ajax_nonce,post_id:this.uploader.PostID,attach_id:this.file.attach_id,caption:this.element.input.caption.val(),content:this.element.input.content.val(),featured:t},success:jQuery.proxy(this.UpdateDescriptionSuccess,this),error:RTCL.File.BrowserError})},RTCL.File.Browser.prototype.UpdateDescriptionSuccess=function(e){if(this.element.spinner.hide(),1==e.result){this.element.success.fadeIn("fast",(function(){jQuery(this).delay(500).fadeOut("slow")}));var t=this.element.input.featured.prop("checked")?1:0,i=this,r=e;jQuery.each(this.uploader.Item,(function(e,s){s.result.attach_id==i.file.attach_id?(s.result=r.file,s.render(),i.file=r.file):t&&(s.result.featured=0,s.render())}))}else alert(e.error)},RTCL.File.Browser.Other=function(){},window.RTCL=RTCL,function(e){"undefined"!=typeof RTCL_PLUPLOAD_DATA&&e.each(RTCL_PLUPLOAD_DATA,(function(e,t){RTCL.File.Registered.push(new RTCL.File.Uploader(t))}))}(jQuery);
